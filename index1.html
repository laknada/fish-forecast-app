<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fish Group Forecast App</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background: #e0f7fa;
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background: #00796b;
      color: white;
      padding: 1em;
      text-align: center;
    }

    main {
      flex: 1;
      padding: 2em;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .forecast {
      background: white;
      padding: 2em;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-width: 500px;
      width: 100%;
      text-align: center;
    }

    .forecast h2 {
      margin-bottom: 1em;
    }

    label, select, button {
      display: block;
      margin: 0.5em 0;
    }

    select {
      width: 100%;
      padding: 0.5em;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    button {
      background: #00796b;
      color: white;
      border: none;
      padding: 0.7em;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background: #004d40;
    }

    #forecastResult {
      margin-top: 1em;
      padding: 1em;
      background: #f1f8e9;
      border: 1px solid #c5e1a5;
      border-radius: 4px;
    }

    #map {
      height: 400px;
      width: 100%;
      margin-top: 20px;
    }

    footer {
      text-align: center;
      background: #004d40;
      color: white;
      padding: 1em;
      margin-top: 2em;
    }
  </style>
</head>
<body>
  <header>
    <h1>Fish Group Forecast for Fishermen</h1>
  </header>
  
  <main>
    <section class="forecast">
      <h2>Forecast Locations</h2>
      <form id="forecastForm">
        <label for="location">Select Ocean Areas:</label>
        <select id="location" name="location" multiple required>
          <option value="Atlantic Ocean">Atlantic Ocean</option>
          <option value="Pacific Ocean">Pacific Ocean</option>
          <option value="Indian Ocean">Indian Ocean</option>
          <option value="Southern Ocean">Southern Ocean</option>
          <option value="Arctic Ocean">Arctic Ocean</option>
        </select>
        <button type="submit">Get Forecast</button>
      </form>
      
      <div id="forecastResult">
        <!-- Results will display here -->
      </div>
    </section>
    
    <!-- Map (Leaflet) -->
    <div id="map"></div>
  </main>
  
  <footer>
    <p>© 2024 Fisherman App</p>
  </footer>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script>
    const API_KEY = 'b31a0d1c35bae23d512352a1225e4ed5'; // Your OpenWeatherMap API Key

    // Initialize Leaflet map
    const map = L.map('map').setView([20, 0], 2); // Center map on the world

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Marker management
    let markers = [];

    // Example coordinates for ocean locations
    const oceanCoordinates = {
      "Atlantic Ocean": [0.0, -30.0],
      "Pacific Ocean": [0.0, -160.0],
      "Indian Ocean": [-20.0, 80.0],
      "Southern Ocean": [-60.0, 10.0],
      "Arctic Ocean": [70.0, 0.0]
    };

    // Function to get weather data from OpenWeatherMap API
    async function getWeatherData(lat, lon) {
      try {
        const weatherUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${API_KEY}`;
        const uvUrl = `https://api.openweathermap.org/data/2.5/uvi?lat=${lat}&lon=${lon}&appid=${API_KEY}`;

        const [weatherResponse, uvResponse] = await Promise.all([
          fetch(weatherUrl),
          fetch(uvUrl)
        ]);

        if (!weatherResponse.ok) {
          throw new Error(`Weather data fetch failed: ${weatherResponse.statusText}`);
        }

        if (!uvResponse.ok) {
          throw new Error(`UV index fetch failed: ${uvResponse.statusText}`);
        }

        const weatherData = await weatherResponse.json();
        const uvData = await uvResponse.json();

        return {
          weather: weatherData,
          uv: uvData
        };
      } catch (error) {
        console.error("Error fetching data: ", error);
        return null;
      }
    }

    // Fetch fish forecast and show results
    document.getElementById('forecastForm').addEventListener('submit', async function(event) {
      event.preventDefault();

      // Clear existing markers
      markers.forEach(marker => marker.remove());
      markers = [];

      // Fetch the selected locations
      const selectedOptions = Array.from(document.getElementById('location').selectedOptions);
      const locations = selectedOptions.map(option => option.value);

      let forecastHTML = `<h3>Forecast for: ${locations.join(', ')}</h3>`;
      forecastHTML += '<ul>';

      // Fetch weather data for each selected location
      for (const location of locations) {
        const latLng = oceanCoordinates[location];

        if (latLng) {
          const weatherData = await getWeatherData(latLng[0], latLng[1]);

          if (weatherData) {
            const { weather, uv } = weatherData;

            forecastHTML += `
              <li>
                <strong>${location}</strong><br>
                Weather: ${weather.weather[0].description}, ${weather.main.temp}°C<br>
                UV Index: ${uv.value}<br>
                Fish Groups: Tuna, Salmon, Mackerel<br>
                Best Time to Fish: 6:00 AM - 10:00 AM
              </li>
            `;

            const marker = L.marker(latLng).addTo(map)
              .bindPopup(`
                <b>${location}</b><br>
                Weather: ${weather.weather[0].description}, ${weather.main.temp}°C<br>
                UV Index: ${uv.value}<br>
                Fish Groups: Tuna, Salmon, Mackerel<br>
                Best Time to Fish: 6:00 AM - 10:00 AM
              `);
            markers.push(marker);
          } else {
            forecastHTML += `<li><strong>${location}</strong>: No weather data available.</li>`;
          }
        }
      }

      forecastHTML += '</ul>';
      document.getElementById('forecastResult').innerHTML = forecastHTML;
    });
  </script>
</body>
</html>
